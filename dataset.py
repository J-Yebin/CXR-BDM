 # -*- coding: utf-8 -*-
"""[CXR-BDM] CNN_keras_3.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Gl6O5wdxyLymTSo6r4djGfMtNe4JFDcq
"""

import os
from google.colab import drive
drive.mount('/content/drive/')

!pip install pydicom

import os
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import pydicom as dicom
import pickle

from tensorflow import keras
from tensorflow.keras import layers
from skimage.transform import resize

import cv2

df = pd.read_csv('/content/drive/MyDrive/Endo-CXR/chestpa_BMD_20210414DXA.xls - Sheet1.csv')

basic_path = "/content/drive/MyDrive/Endo-CXR"

ptid = df['실명등록번호'].to_numpy()
osteo = df['osteoporosis'].to_numpy()

#load
with open(basic_path + '/TotalPA', 'rb') as f:
    TotalPA = pickle.load(f)

#making training dataset: resized at first
x_train = []
y_train = []

px_size = 256

for i in TotalPA:
    ds = dicom.dcmread(i)
    
    resized = resize(ds.pixel_array, (px_size, px_size), anti_aliasing=True)

    index = np.where(ptid == ds.PatientID)
    osteo_class = osteo[index].tolist()

    x_train.append(resized)
    y_train.append(osteo_class[0])

x_train = np.array(x_train)
y_train = np.array(y_train)


with open(basic_path+'/x_train', 'rb') as f:
    x_train = pickle.load(f)

with open(basic_path+'/y_train', 'rb') as f:
    y_train = pickle.load(f)